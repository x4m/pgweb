{%extends "base/page.html"%}
{%load pgfilters%}
{%block title%}My Badge Claims{%endblock%}
{%block contents%}
<div class="container">
  <h1><i class="fa fa-list"></i> My Badge Claims</h1>
  <p class="lead">Track the status of your badge claim requests</p>
  
  <div class="mb-3">
    <a href="/account/badges/" class="btn btn-primary">
      <i class="fa fa-plus"></i> Browse Available Badges
    </a>
    <a href="/account/badges/{{user.username}}/" class="btn btn-success">
      <i class="fa fa-trophy"></i> View My Earned Badges
    </a>
  </div>
  
  {%if claims%}
  <div class="row mt-4">
    {%for claim in claims%}
    <div class="col-md-12 mb-3">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-md-1 text-center">
              <i class="fa {{claim.badge.icon}} fa-3x" style="color: {{claim.badge.color}};"></i>
            </div>
            <div class="col-md-8">
              <h5>
                {{claim.badge.name}}
                {%if claim.status == 'pending'%}
                <span class="badge badge-warning">Pending</span>
                {%elif claim.status == 'approved'%}
                <span class="badge badge-success">Approved</span>
                {%elif claim.status == 'rejected'%}
                <span class="badge badge-danger">Rejected</span>
                {%endif%}
              </h5>
              <p class="text-muted mb-2">
                <i class="fa fa-building"></i> {{claim.badge.organisation.name}}
              </p>
              <p class="mb-2">{{claim.badge.description}}</p>
              
              {%if claim.message%}
              <details class="mt-2">
                <summary class="text-muted small" style="cursor: pointer;">
                  <i class="fa fa-comment"></i> Your message
                </summary>
                <p class="text-muted small mt-2 ml-3">{{claim.message}}</p>
              </details>
              {%endif%}
              
              {%if claim.status != 'pending'%}
              <div class="mt-2">
                <small class="text-muted">
                  Reviewed by {{claim.reviewed_by.username}} on {{claim.reviewed_at|date:"M d, Y"}}
                </small>
                {%if claim.review_note%}
                <div class="alert alert-light small mt-2">
                  <strong>Reviewer's note:</strong> {{claim.review_note}}
                </div>
                {%endif%}
              </div>
              {%endif%}
            </div>
            <div class="col-md-3 text-right">
              <small class="text-muted">
                Claimed<br>{{claim.claimed_at|date:"M d, Y"}}
              </small>
              {%if claim.status == 'approved'%}
              <div class="mt-3">
                <a href="/account/badges/{{user.username}}/" class="btn btn-sm btn-success">
                  <i class="fa fa-trophy"></i> View Badge
                </a>
              </div>
              {%endif%}
            </div>
          </div>
        </div>
      </div>
    </div>
    {%endfor%}
  </div>
  
  <div class="alert alert-info mt-4">
    <h5><i class="fa fa-info-circle"></i> Claim Status Guide</h5>
    <ul class="mb-0">
      <li><span class="badge badge-warning">Pending</span> - Waiting for organization managers to review</li>
      <li><span class="badge badge-success">Approved</span> - Congratulations! The badge has been added to your profile</li>
      <li><span class="badge badge-danger">Rejected</span> - The organization declined your request</li>
    </ul>
  </div>
  {%else%}
  <div class="alert alert-info mt-4">
    <h5><i class="fa fa-info-circle"></i> No Claims Yet</h5>
    <p class="mb-0">
      You haven't claimed any badges yet. 
      <a href="/account/badges/">Browse available badges</a> to get started!
    </p>
  </div>
  {%endif%}
</div>
{%endblock%}



